import streamlit as st
import google.generativeai as genai

# ==========================================
# 1. ุฅุนุฏุงุฏุงุช ุงูุตูุญุฉ ูุงูุชุตููู (CSS)
# ==========================================
st.set_page_config(page_title="Diwan Editor Pro", layout="wide", page_icon="๐๏ธ")

# CSS ูุฎุตุต ูุฅุตูุงุญ ุงูุนููุจ ูุฌุนู ุงููุธูุฑ ุงุญุชุฑุงููุงู
st.markdown("""
<style>
    /* ุงุณุชูุฑุงุฏ ุฎุท ุนุฑุจู ุฃููู (Cairo) */
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');

    html, body, [class*="css"] {
        font-family: 'Cairo', sans-serif;
        direction: rtl;
    }

    /* ุชุญุณูู ุดูู ุงูุฃุฒุฑุงุฑ */
    .stButton>button {
        border-radius: 8px;
        height: 3em;
        font-weight: bold;
        border: 1px solid #ddd;
        transition: 0.3s;
    }
    .stButton>button:hover {
        border-color: #0E738A;
        color: #0E738A;
        background-color: #f0f8ff;
    }

    /* ุตูุฏูู ุงููุชูุฌุฉ (ุงูุญู ููุดููุฉ ุงูุจุชุฑ ูุงูุดูู ุงูุฌูุงูู) */
    .result-card {
        background-color: #ffffff;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        border-right: 6px solid #0E738A; /* ููู ูููุฉ ุฏููุงู */
        margin-top: 20px;
        font-size: 16px;
        line-height: 1.8;
        color: #333;
        white-space: pre-wrap; /* ูููุน ุจุชุฑ ุงููุต ููุญูุธ ุงูุชูุณูู */
    }

    /* ุชุญุณูู ุนููุงู ุงูุตูุญุฉ */
    h1 { color: #0E738A; text-align: center; margin-bottom: 30px; }
    
    /* ุฅุฎูุงุก ุงูููุงุฆู ุงูุนูููุฉ ุงููุฒุนุฌุฉ */
    #MainMenu {visibility: hidden;}
    footer {visibility: hidden;}
</style>
""", unsafe_allow_html=True)

# ==========================================
# 2. ุงูุงุชุตุงู (Connection)
# ==========================================
try:
    api_key = st.secrets["GEMINI_API_KEY"]
    genai.configure(api_key=api_key)
except:
    st.error("โ๏ธ ุงูููุชุงุญ ููููุฏ. ุชุฃูุฏ ูู ุฅุถุงูุชู ูู Settings -> Secrets")
    st.stop()

# ==========================================
# 3. "ุงูุจุฑููุจุช" ุงูุฎุงุต ุจู (ููุงู ุงูุชุนุฏูู)
# ==========================================
# ุถุน ุงูุจุฑููุจุช ุงูุฎุงุต ุจู ููุง ุจูู ุนูุงูุงุช ุงูุชูุตูุต ุงูุซูุงุซูุฉ
MASTER_PROMPT = """
ุฃูุช ุตุญูู ูุฎุจูุฑ ุชุญุฑูุฑ ูู ุฅุฐุงุนุฉ "ุฏููุงู ุฃู ุฃู".
ุฏูุฑู: ุฅุนุงุฏุฉ ุตูุงุบุฉ ุงููุต ุงููุฏุฎู ููุตุจุญ ูุงุฏุฉ ุตุญููุฉ ุงุญุชุฑุงููุฉ ูุฌุงูุฒุฉ ูููุดุฑ.

ุงูููุงุนุฏ ุงูุตุงุฑูุฉ:
1. ุงุณุชุฎุฏู ูุบุฉ ุนุฑุจูุฉ ูุตุญูุ ูููุฉุ ูุณูุณุฉ (ุงูุณูู ุงูููุชูุน).
2. ุงุจุชุนุฏ ุนู ุงูุญุดู (ูุซู: ููุง ูุง ุดู ูููุ ูุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ).
3. ุงุญุฐู ุงูุฃููุงุจ ุงูุชูุฎูููุฉ ูุงูุชูู ุจุงูุตูุฉ ุงููุธูููุฉ ูุงูุงุณู.
4. ุงุณุชุฎุฏู ุฃุณููุจ "ุงููุฑู ุงูููููุจ": ุงููุนูููุฉ ุงูุฃูู ุฃููุงู.
5. ูุณูู ุงููุต ุฅูู ููุฑุงุช ูุตูุฑุฉ ููุฑูุญุฉ ููุนูู.

ุงููุทููุจ: ุตูุงุบุฉ ุงููุต ุจุดูู ูุชูุงููุ ูุน ูุถุน ุนููุงู ููุชุฑุญ ูู ุงูุจุฏุงูุฉ.
"""

# ==========================================
# 4. ูุงุฌูุฉ ุงูุชุทุจูู (UI)
# ==========================================
st.title("๐๏ธ Diwan Smart Editor")

# ุชูุณูู ุงูุตูุญุฉ ูุนููุฏูู (ูููุธูุฑ ุงูุฌูุงูู)
c1, c2 = st.columns([3, 1])

with c1:
    # ููุทูุฉ ุงูุฅุฏุฎุงู
    input_text = st.text_area("ุงููุต ุงูุฎุงู (ุงููุฏุฎูุงุช):", height=200, placeholder="ุฃุฏุฎู ุงููุต ุฃู ุฑุคูุณ ุงูุฃููุงู ููุง...")
    
    # ุฒุฑ ุงูุชูููุฐ
    if st.button("๐ ูุนุงูุฌุฉ ุงููุต ูุชุญุณููู", type="primary"):
        if input_text:
            with st.spinner('ุฌุงุฑู ุงูุตูุงุบุฉ ูุงูุชุญุฑูุฑ...'):
                try:
                    # ุงุฎุชูุงุฑ ุงูููุฏูู ุชููุงุฆูุงู (ุชุฌุงูุฒ ุฃุฎุทุงุก 404)
                    try:
                        model = genai.GenerativeModel('gemini-1.5-flash')
                    except:
                        model = genai.GenerativeModel('gemini-pro')

                    # ุฅุฑุณุงู ุงูุทูุจ
                    response = model.generate_content(f"{MASTER_PROMPT}\n\nุงููุต ูููุนุงูุฌุฉ:\n{input_text}")
                    
                    # ุนุฑุถ ุงููุชูุฌุฉ ุฏุงุฎู ุงูุตูุฏูู ุงูุฌูุงูู (HTML Box)
                    st.markdown(f"""
                        <div class="result-card">
                            {response.text}
                        </div>
                    """, unsafe_allow_html=True)
                    
                except Exception as e:
                    st.error(f"ุญุฏุซ ุฎุทุฃ ุชููู: {e}")
        else:
            st.warning("ุงูุฑุฌุงุก ุฅุฏุฎุงู ูุต ูููุนุงูุฌุฉ.")

with c2:
    # ูุนูููุงุช ุฌุงูุจูุฉ
    st.info("๐ก **ูุตุงุฆุญ:**\n\n- ููุญุตูู ุนูู ุฃูุถู ูุชูุฌุฉุ ููุฑ ุชูุงุตูู ูุงุถุญุฉ.\n- ูุฐุง ุงููุธุงู ูุณุชุฎุฏู ุงูููุงุนุฏ ุงูุชุญุฑูุฑูุฉ ุงูุฎุงุตุฉ ุจุงูุฅุฐุงุนุฉ.")
    st.image("https://cdn-icons-png.flaticon.com/512/2965/2965879.png", width=100)
